<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificar Estado de Pagos - Academia COHAB</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#dc2626">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="COHAB Sistema">
    <meta name="description" content="Verificaci√≥n de estado de pagos - Academia COHAB">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="logo_cohab.png">
    <link rel="apple-touch-icon" href="logo_cohab.png">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <img src="logo_cohab.svg" alt="Academia COHAB BJJ" class="logo" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDIwMCAxMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIxMjAiIGZpbGw9IiMwMDAwMDAiIHJ4PSI4Ii8+PHRleHQgeD0iMTAwIiB5PSI3MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCBCbGFjaywgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIzNiIgZm9udC13ZWlnaHQ9IjkwMCIgbGV0dGVyLXNwYWNpbmc9IjJweCI+Q09IQUI8L3RleHQ+PC9zdmc+'">
            <ul class="nav-links">
                <li><a href="index.html">Gesti√≥n de Alumnos</a></li>
                <li><a href="verificar.html" class="active">Verificar QR</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <!-- Secci√≥n de Verificaci√≥n -->
        <section class="verificar-section">
            <h2>üîç Verificar Estado de Pago</h2>
            <p class="subtitle">Escanea el c√≥digo QR del alumno o ingresa el ID manualmente</p>
            
            <div class="verificar-options">
                <div class="option-card">
                    <h3>üì± Escanear QR</h3>
                    <div style="display:flex; gap:0.5rem; flex-wrap:wrap; justify-content:center;">
                        <button class="btn btn-primary" onclick="startScanner()">Iniciar C√°mara</button>
                        <button class="btn btn-secondary" onclick="stopScanner()">Detener C√°mara</button>
                        <button class="btn btn-secondary" id="torchBtn" onclick="toggleTorch()" style="display:none;">üí° Linterna</button>
                    </div>
                    <div style="margin-top:0.75rem; display:flex; gap:0.5rem; align-items:center; justify-content:center; flex-wrap:wrap;">
                        <select id="cameraSelect" class="btn" style="min-width:220px; background:#111827; color:#fff; border:1px solid #374151; display:none;" onchange="switchCamera(this.value)"></select>
                        <label class="btn btn-secondary" for="imageInput" style="cursor:pointer;">üìÅ Subir imagen</label>
                        <input id="imageInput" type="file" accept="image/*" capture="environment" style="display:none;" onchange="decodeFromImage(event)">
                    </div>
                    <div id="scanner-container" style="display: none;">
                        <div class="scanner-overlay">
                            <div class="scanner-frame">
                                <div class="scanner-corners">
                                    <div class="corner top-left"></div>
                                    <div class="corner top-right"></div>
                                    <div class="corner bottom-left"></div>
                                    <div class="corner bottom-right"></div>
                                </div>
                                <video id="video" autoplay muted playsinline></video>
                                <canvas id="canvas" style="display: none;"></canvas>
                            </div>
                            <div class="scanner-instructions">
                                <p>üì± Apunta la c√°mara al c√≥digo QR del alumno</p>
                                <p>üîç El c√≥digo se detectar√° autom√°ticamente</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="option-divider">O</div>
                
                <div class="option-card">
                    <h3>‚úèÔ∏è Ingreso Manual</h3>
                    <input type="text" id="manualId" placeholder="Ingresa el ID del alumno">
                    <button class="btn btn-primary" onclick="verificarManual()">Verificar</button>
                </div>
            </div>
        </section>

        <!-- Resultado de Verificaci√≥n -->
        <div id="resultadoVerificacion" class="resultado-container" style="display: none;">
            <div class="resultado-card">
                <div id="resultadoHeader" class="resultado-header">
                    <div class="status-icon" id="statusIcon">‚úÖ</div>
                    <h3 id="alumnoNombre">Nombre del Alumno</h3>
                    <p id="estadoPago">üü¢ Al d√≠a</p>
                </div>
                
                <!-- Informaci√≥n del Alumno -->
                <div class="resultado-body">
                    <div class="info-section">
                        <h4>üìã Informaci√≥n Personal</h4>
                        <div class="info-row">
                            <span class="label">ID del Alumno:</span>
                            <span class="value" id="alumnoId">ID123456</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Email:</span>
                            <span class="value" id="alumnoEmail">alumno@email.com</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Tel√©fono:</span>
                            <span class="value" id="alumnoTelefono">+1234567890</span>
                        </div>
                    </div>
                    
                    <div class="info-section">
                        <h4>üí∞ Estado de Pago</h4>
                        <div class="info-row">
                            <span class="label">√öltimo Pago:</span>
                            <span class="value" id="ultimoPago">01/01/2024</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Pr√≥ximo Pago:</span>
                            <span class="value" id="proximoPago">01/02/2024</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Monto Mensual:</span>
                            <span class="value" id="montoMensual">$50.00</span>
                        </div>
                        <div class="info-row" id="diasRestantesRow">
                            <span class="label">D√≠as Restantes:</span>
                            <span class="value" id="diasRestantes">15 d√≠as</span>
                        </div>
                        <div class="info-row" id="diasAtrasadosRow" style="display: none;">
                            <span class="label">D√≠as Atrasado:</span>
                            <span class="value" id="diasAtrasados">5 d√≠as</span>
                        </div>
                    </div>
                    
                    <!-- C√≥digo QR del Alumno -->
                    <div class="qr-section">
                        <h4>üî≤ C√≥digo QR del Alumno</h4>
                        <div id="qrDisplay" class="qr-display">
                            <!-- El QR se generar√° aqu√≠ -->
                        </div>
                        <div class="qr-info">
                            <p><strong>ID:</strong> <span id="qrId">ID123456</span></p>
                            <button class="btn btn-small" onclick="downloadQR()">üì• Descargar QR</button>
                        </div>
                    </div>
                </div>
                
                <div class="resultado-footer">
                    <button class="btn btn-success" onclick="registrarPago()">üí≥ Registrar Pago</button>
                    <button class="btn btn-primary" onclick="mostrarQRCompleto()">üî≤ Ver QR Completo</button>
                    <button class="btn btn-secondary" onclick="cerrarResultado()">Cerrar</button>
                </div>
            </div>
        </div>

        <!-- Vista R√°pida de Todos los Alumnos -->
        <section class="todos-alumnos-section">
            <h3>üë• Vista R√°pida - Todos los Alumnos</h3>
            <p class="subtitle">Haz clic en cualquier tarjeta para verificar su estado</p>
            
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterStatus('all')">Todos</button>
                <button class="filter-btn" onclick="filterStatus('atrasado')">üî¥ Atrasados</button>
                <button class="filter-btn" onclick="filterStatus('proximo')">üü† Pr√≥ximos a vencer</button>
                <button class="filter-btn" onclick="filterStatus('aldia')">üü¢ Al d√≠a</button>
            </div>
            
            <div id="todosAlumnos" class="todos-alumnos-grid">
                <!-- Los alumnos se cargar√°n aqu√≠ din√°micamente -->
            </div>
        </section>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js"></script>
    <script src="alert-system.js"></script>
    <script src="verificar.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registrado exitosamente:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('Error al registrar ServiceWorker:', error);
                    });
            });
        }
    </script>
</body>
</html>
