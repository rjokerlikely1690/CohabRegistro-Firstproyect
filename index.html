<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
  <title>COHAB BJJ — San Carlos de Apoquindo | Disciplina, comunidad y progreso</title>
  <meta name="theme-color" content="#dc2626">
  <meta name="description" content="Academia de Brazilian Jiu-Jitsu en San Carlos de Apoquindo (Las Condes). Disciplina compartida, comunidad real y progreso con estructura.">

  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="img/logo_cohab.png">
  <link rel="apple-touch-icon" href="img/logo_cohab.png">
  <link rel="stylesheet" href="css/styles.css?v=36">
  <style>
    /* CRÍTICO MÓVIL - Forzar navbar responsive */
    @media (max-width: 768px) {
      html, body {
        overflow-x: hidden !important;
        width: 100% !important;
        max-width: 100vw !important;
      }
      body.marketing .navbar {
        overflow-x: hidden !important;
        width: 100% !important;
        max-width: 100vw !important;
      }
      body.marketing .navbar .container {
        min-height: 56px !important;
        padding: 0 0.75rem !important;
        overflow-x: hidden !important;
        width: 100% !important;
        max-width: 100% !important;
      }
      body.marketing .navbar .logo {
        height: 32px !important;
        flex-shrink: 0 !important;
      }
      body.marketing .nav-links {
        display: none !important;
      }
      .marketing-menu-btn {
        display: inline-flex !important;
        min-width: 44px !important;
        width: 44px !important;
        height: 44px !important;
      }
      .site-actions .btn-primary {
        display: none !important;
      }
      .marketing-main, .marketing-wrap {
        overflow-x: hidden !important;
        width: 100% !important;
        max-width: 100vw !important;
      }
    }
  </style>
</head>
<body class="marketing">
  <nav class="navbar" role="navigation" aria-label="Navegación principal">
    <div class="container">
      <a href="index.html" aria-label="Ir a Inicio" style="display:flex; align-items:center; text-decoration:none;">
        <img src="img/logo_cohab.svg" alt="COHAB BJJ" class="logo" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDIwMCAxMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIxMjAiIGZpbGw9IiMwMDAwMDAiIHJ4PSI4Ii8+PHRleHQgeD0iMTAwIiB5PSI3MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCBCbGFjaywgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIzNiIgZm9udC13ZWlnaHQ9IjkwMCIgbGV0dGVyLXNwYWNpbmc9IjJweCI+Q09IQUI8L3RleHQ+PC9zdmc+'">
      </a>

      <ul class="nav-links" aria-label="Secciones">
        <li><a href="index.html" class="active">Inicio</a></li>
        <li><a href="clases.html">Clases</a></li>
        <li><a href="metodologia.html">Metodología</a></li>
        <li><a href="comunidad.html">Comunidad</a></li>
        <li><a href="horarios.html">Horarios</a></li>
        <li><a href="contacto.html">Contacto</a></li>
      </ul>

      <div class="site-actions" aria-label="Acciones">
        <a class="btn btn-primary btn-small" href="contacto.html">Empieza a entrenar</a>
        <a class="btn btn-secondary btn-small" href="login.html">Ingresar</a>
        <button class="marketing-menu-btn" type="button" id="menuBtn" aria-label="Abrir menú"></button>
      </div>
    </div>
  </nav>

  <div class="marketing-drawer-backdrop" id="drawerBackdrop" aria-hidden="true"></div>
  <aside class="marketing-drawer" id="drawer" aria-hidden="true" aria-label="Menú">
    <div class="drawer-head">
      <div class="drawer-title">COHAB BJJ</div>
      <button class="drawer-close" type="button" id="drawerClose" aria-label="Cerrar menú">CERRAR</button>
    </div>
    <nav>
      <a href="index.html"><span>Inicio</span><span>›</span></a>
      <a href="clases.html"><span>Clases</span><span>›</span></a>
      <a href="metodologia.html"><span>Metodología</span><span>›</span></a>
      <a href="comunidad.html"><span>Comunidad</span><span>›</span></a>
      <a href="horarios.html"><span>Horarios</span><span>›</span></a>
      <a href="contacto.html"><span>Contacto</span><span>›</span></a>
      <a href="faq.html"><span>Preguntas frecuentes</span><span>›</span></a>
      <a href="ubicacion.html"><span>Ubicación</span><span>›</span></a>
    </nav>
    <div class="drawer-actions">
      <a class="btn btn-primary" href="login.html" style="width:100%; justify-content:center;">Ingresar</a>
    </div>
  </aside>

  <main class="marketing-main">
    <div class="marketing-wrap">
      <section class="marketing-hero" aria-label="Hero">
        <div class="hero-grid">
          <div>
            <h1>Transforma tu entrenamiento: disciplina que se comparte.</h1>
            <p class="hero-sub">
              Brazilian Jiu‑Jitsu en San Carlos de Apoquindo. Un lugar serio para construir constancia, técnica y comunidad:
              te entrenas con método y convives con una rutina compartida.
            </p>
            <div class="hero-ctas">
              <a class="btn btn-primary cta-with-badge" href="contacto.html">
                <span class="cta-badge">Primera clase GRATIS</span>
                Empieza a entrenar
              </a>
              <a class="btn btn-secondary" href="#horariosHome">Ver horarios</a>
            </div>
            <div class="hero-chips" aria-label="Señales de identidad">
              <span class="chip">Disciplina compartida</span>
              <span class="chip">Progreso guiado</span>
              <span class="chip">Comunidad real</span>
            </div>
            <div class="hero-image-wrap" aria-hidden="true">
              <img src="img/hero-bjj.png" alt="Entrenamiento BJJ en COHAB" class="hero-image" loading="lazy" width="560" height="360">
            </div>
          </div>
          <aside class="hero-aside">
            <div style="margin-bottom: 1.5rem;">
              <p class="aside-title">San Carlos de Apoquindo, Las Condes</p>

              <!-- Stats visuales -->
              <div class="hero-stats">
                <div class="stat-item">
                  <div class="stat-number">200+</div>
                  <div class="stat-label">Alumnos activos</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number">15</div>
                  <div class="stat-label">Años de experiencia</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number">6</div>
                  <div class="stat-label">Clases semanales</div>
                </div>
              </div>

              <p class="aside-line" style="margin-top: 1rem;"><strong>Dirección:</strong> Av. San Carlos de Apoquindo 3450</p>
              <p class="aside-line"><strong>WhatsApp:</strong> +56 9 1234 5678</p>
              <p class="aside-line"><strong>Instagram:</strong> @cohabbjjscl</p>
              <p class="aside-line" style="margin-top: 0.85rem; color: rgba(255,255,255,0.72);">
                Principiantes bienvenidos. Primera clase guiada (Gi/NoGi).
              </p>
            </div>
            
            <!-- Nueva sección: Consulta de estado -->
            <div id="consulta-estado" class="alumno-consulta-card" style="background: rgba(26, 26, 26, 0.6); border: 1px solid rgba(220, 38, 38, 0.3); border-radius: 12px; padding: 1.5rem; margin-top: 1.5rem;">
              <div style="text-align: center; margin-bottom: 1rem;">
                <img src="img/monito_kimono.png" alt="Monito con kimono" style="width: 80px; height: auto; display: block; margin: 0 auto; filter: drop-shadow(0 2px 8px rgba(220, 38, 38, 0.3));">
              </div>
              <p class="aside-title" style="margin-bottom: 0.75rem; color: #dc2626; text-align: center;">¿Eres alumno? Consulta tu estado</p>
              <p style="color: rgba(255,255,255,0.85); font-size: 0.9rem; line-height: 1.5; margin-bottom: 1.25rem;">
                Escanea tu código QR o ingresa tu ID para ver el estado de tus pagos y acceder a tu información personal.
              </p>
              
              <!-- Opción 1: Escanear QR -->
              <div style="margin-bottom: 1rem;">
                <button id="scanQRBtnIndex" class="btn btn-secondary" style="width: 100%; justify-content: center; gap: 0.5rem; margin-bottom: 0.75rem;" onclick="toggleQRScannerIndex()">
                  <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                    <path d="M9.5 6.5v3h-3v-3h3M11 5H5v6h6V5zm-1.5 9.5v3h-3v-3h3M11 13H5v6h6v-6zm6.5-6.5v3h-3v-3h3M19 5h-6v6h6V5zm-6 13h1.5v1.5H13V18zm1.5 1.5H16V21h-1.5v-1.5zm3.75-3.75h1.5v1.5h-1.5v-1.5zM19 13h1.5v6H19v-6zm-8.25 3.75h1.5v1.5h-1.5v-1.5zm0-3.75h1.5v1.5h-1.5V13z"/>
                  </svg>
                  <span id="scanQRTextIndex">Escanear QR</span>
                </button>
                <div id="qrScannerContainerIndex" style="display: none; margin-top: 0.75rem;">
                  <div id="qrScanningOverlayIndex" style="position: relative; width: 100%; aspect-ratio: 1; background: #000; border-radius: 8px; overflow: hidden;">
                    <video id="qrVideoIndex" style="width: 100%; height: 100%; object-fit: cover; display: block;"></video>
                    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center;">
                      <div style="width: 200px; height: 200px; border: 3px solid #dc2626; border-radius: 8px; box-shadow: 0 0 0 9999px rgba(0,0,0,0.6);"></div>
                    </div>
                  </div>
                  <canvas id="qrCanvasIndex" style="display: none;"></canvas>
                  <button class="btn btn-secondary" onclick="stopQRScannerIndex()" style="width: 100%; margin-top: 0.5rem;">Detener cámara</button>
                </div>
              </div>
              
              <!-- Opción 2: Ingresar ID manualmente -->
              <div style="margin-bottom: 1rem;">
                <input 
                  type="text" 
                  id="alumnoIdInputIndex" 
                  placeholder="Ingresa tu ID de alumno" 
                  style="width: 100%; padding: 0.75rem; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: #fff; font-size: 0.9rem; margin-bottom: 0.75rem;"
                  onkeypress="if(event.key === 'Enter') consultarAlumnoIndex()"
                >
                <button class="btn btn-primary" onclick="consultarAlumnoIndex()" style="width: 100%; justify-content: center;">
                  Consultar estado
                </button>
              </div>
              
              <!-- Link de ayuda -->
              <p style="text-align: center; margin-top: 1rem;">
                <a href="contacto.html" style="color: rgba(220, 38, 38, 0.9); text-decoration: none; font-size: 0.85rem; border-bottom: 1px solid rgba(220, 38, 38, 0.3);">
                  ¿No tienes tu QR? Contáctanos
                </a>
              </p>
            </div>
          </aside>
        </div>
      </section>

      <section class="marketing-section" aria-label="Beneficios">
        <h2>Beneficios reales, desde la primera semana</h2>
        <p class="lead">
          Seriedad no es rigidez: es estructura. Progreso no es suerte: es constancia. Y la constancia se sostiene mejor en equipo.
        </p>
        <div class="card-grid-4">
          <div class="mcard"><h3>Técnica con estructura</h3><p>Fundamentos claros para avanzar sin improvisar.</p></div>
          <div class="mcard"><h3>Constancia que se sostiene</h3><p>Rutina compartida: el equipo te empuja.</p></div>
          <div class="mcard"><h3>Confianza y control</h3><p>Calma bajo presión, con guía y seguridad.</p></div>
          <div class="mcard"><h3>Condición con propósito</h3><p>Fuerza y resistencia aplicadas al tatami.</p></div>
        </div>
        <p style="margin-top: 1rem; color: rgba(255,255,255,0.68);">
          Más detalle en <a href="clases.html" style="color:#fff;">Clases</a>.
        </p>
      </section>

      <section class="marketing-section" aria-label="Metodología">
        <h2>Metodología: fundamentos → progreso → constancia</h2>
        <p class="lead">Un camino claro para principiantes e intermedios: técnica, cultura y rutina que se comparte.</p>
        <div class="process-steps">
          <div class="step-list">
            <div class="step"><div class="n">1</div><div><p class="t">Fundamentos</p><p class="d">Base sólida y segura, sin saltos.</p></div></div>
            <div class="step"><div class="n">2</div><div><p class="t">Progreso</p><p class="d">Objetivos claros, correcciones y práctica con intención.</p></div></div>
            <div class="step"><div class="n">3</div><div><p class="t">Transformar la rutina</p><p class="d">Hábito compartido: respeto, equipo y constancia.</p></div></div>
          </div>
          <div class="mcard">
            <h3>Una academia, no solo una clase</h3>
            <p>La convivencia del entrenamiento crea pertenencia: entrenas con otros, sostienes hábitos, y el progreso se vuelve visible.</p>
            <div style="margin-top: 1rem;">
              <a class="btn btn-secondary" href="metodologia.html">Ver metodología</a>
            </div>
          </div>
        </div>
      </section>

      <section class="marketing-section" aria-label="Comunidad">
        <h2>Comunidad que entrena junta</h2>
        <p class="lead">Compañerismo, respeto mutuo y superación conjunta. Serios para entrenar, humanos para convivir.</p>
        <div class="card-grid-2">
          <div class="mcard"><h3>Pertenencia</h3><p>Ambiente firme y acogedor: te reciben, te guían y te empujan.</p></div>
          <div class="mcard"><h3>Cultura del tatami</h3><p>Reglas claras: seguridad, control y respeto para aprender bien.</p></div>
        </div>
        <p style="margin-top: 1rem; color: rgba(255,255,255,0.68);">
          Conoce más en <a href="comunidad.html" style="color:#fff;">Comunidad</a>.
        </p>
      </section>

      <section class="marketing-section" id="horariosHome" aria-label="Horarios">
        <h2>Horarios (vista rápida)</h2>
        <p class="lead">
          Bloque decisivo: elige tu ritmo. Para el detalle completo (verano/invierno), ve a <a href="horarios.html" style="color:#fff;">Horarios</a>.
        </p>
        <div class="schedule-wrap">
          <div class="schedule-grid" aria-label="Horario semanal (resumen)">
            <div class="day-card">
              <div class="day-head">Lunes</div>
              <ul>
                <li class="slot"><div class="time">09:00</div><div><div class="what">BJJ</div><div class="meta">Gi / NoGi</div></div></li>
                <li class="slot"><div class="time">13:00</div><div><div class="what">BJJ</div><div class="meta">Gi / NoGi</div></div></li>
                <li class="slot"><div class="time">17:30</div><div><div class="what">BJJ</div><div class="meta">Gi / NoGi</div></div></li>
              </ul>
            </div>
            <div class="day-card">
              <div class="day-head">Martes</div>
              <ul>
                <li class="slot"><div class="time">09:00</div><div><div class="what">BJJ</div><div class="meta">Gi / NoGi</div></div></li>
                <li class="slot"><div class="time">13:00</div><div><div class="what">BJJ</div><div class="meta">Gi / NoGi</div></div></li>
                <li class="slot"><div class="time">19:45</div><div><div class="what">Kickboxing</div><div class="meta">Técnica + condición</div></div></li>
              </ul>
            </div>
            <div class="day-card">
              <div class="day-head">Miércoles</div>
              <ul>
                <li class="slot"><div class="time">09:00</div><div><div class="what">BJJ</div><div class="meta">Gi / NoGi</div></div></li>
                <li class="slot"><div class="time">13:00</div><div><div class="what">BJJ</div><div class="meta">Gi / NoGi</div></div></li>
                <li class="slot"><div class="time">17:30</div><div><div class="what">BJJ</div><div class="meta">Gi / NoGi</div></div></li>
              </ul>
            </div>
            <div class="day-card">
              <div class="day-head">Jueves</div>
              <ul>
                <li class="slot"><div class="time">09:00</div><div><div class="what">BJJ</div><div class="meta">Gi / NoGi</div></div></li>
                <li class="slot"><div class="time">13:00</div><div><div class="what">BJJ</div><div class="meta">Gi / NoGi</div></div></li>
                <li class="slot"><div class="time">19:45</div><div><div class="what">Kickboxing</div><div class="meta">Técnica + condición</div></div></li>
              </ul>
            </div>
            <div class="day-card">
              <div class="day-head">Viernes</div>
              <ul>
                <li class="slot"><div class="time">09:00</div><div><div class="what">BJJ</div><div class="meta">Gi / NoGi</div></div></li>
                <li class="slot"><div class="time">13:00</div><div><div class="what">BJJ</div><div class="meta">Gi / NoGi</div></div></li>
                <li class="slot"><div class="time">17:30</div><div><div class="what">BJJ</div><div class="meta">Gi / NoGi</div></div></li>
              </ul>
            </div>
            <div class="day-card">
              <div class="day-head">Sábado</div>
              <ul>
                <li class="slot"><div class="time">12:00</div><div><div class="what">Open Mat</div><div class="meta">Sparring supervisado</div></div></li>
           </ul>
            </div>
          </div>
          <aside class="schedule-side">
            <h3>Lectura rápida</h3>
            <ul>
              <li>Brazilian Jiu‑Jitsu (Gi)</li>
              <li>Brazilian Jiu‑Jitsu (NoGi)</li>
              <li>Open Mat / sparring supervisado</li>
              <li>Principiantes bienvenidos</li>
            </ul>
            <div class="cta-stack">
              <a class="btn btn-primary" href="contacto.html">Empieza a entrenar</a>
              <a class="btn btn-secondary" href="horarios.html">Ver horarios</a>
            </div>
          </aside>
        </div>
      </section>

      <section class="marketing-section" aria-label="Confianza">
        <h2>Seriedad y confianza</h2>
        <p class="lead">Cultura del tatami: respeto, seguridad y guía. Entrenas bien, no solo fuerte.</p>
        <div class="card-grid-2">
          <div class="mcard"><h3>Guía</h3><p>Correcciones y progresión responsable: te ayudamos a entrenar con control.</p></div>
          <div class="mcard"><h3>Cultura</h3><p>Reglas claras de respeto mutuo para convivir y aprender en equipo.</p></div>
        </div>
      </section>

      <section class="marketing-section" aria-label="Contacto">
        <h2>Empieza esta semana</h2>
        <p class="lead">Un mensaje y te orientamos para tu primera clase (Gi/NoGi), sin presión y con claridad.</p>
        <div class="card-grid-2">
          <div class="mcard">
            <h3>Cómo empezar (3 pasos)</h3>
            <p>1) Escríbenos por WhatsApp</p>
            <p style="margin-top:0.35rem;">2) Te recomendamos tu primera clase</p>
            <p style="margin-top:0.35rem;">3) Llegas, entrenas y te integras al equipo</p>
          </div>
          <div class="mcard">
            <h3>Contacto</h3>
            <p><strong>Dirección:</strong> Av. San Carlos de Apoquindo 3450, Las Condes</p>
            <p style="margin-top:0.35rem;"><strong>WhatsApp:</strong> +56 9 1234 5678</p>
            <p style="margin-top:0.35rem;"><strong>Instagram:</strong> @cohabbjjscl</p>
            <p style="margin-top:0.35rem;"><strong>Email:</strong> contacto@cohabbjjscl.cl</p>
            <div style="margin-top: 1rem;">
              <a class="btn btn-primary" href="contacto.html">Empieza a entrenar</a>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer class="marketing-footer" role="contentinfo">
    <div class="footer-grid">
      <div>
        <h4>COHAB BJJ</h4>
        <p>San Carlos de Apoquindo, Las Condes</p>
        <p style="color:rgba(255,255,255,0.72);">Disciplina, comunidad y progreso.</p>
      </div>
      <div>
        <h4>Contacto</h4>
        <p>WhatsApp: +56 9 1234 5678</p>
        <p>Email: contacto@cohabbjjscl.cl</p>
        <p>IG: @cohabbjjscl</p>
      </div>
      <div>
        <h4>Ubicación</h4>
        <p>Av. San Carlos de Apoquindo 3450</p>
        <p><a href="ubicacion.html">Cómo llegar</a></p>
      </div>
      <div>
        <h4>Links</h4>
        <p><a href="clases.html">Clases</a></p>
        <p><a href="horarios.html">Horarios</a></p>
        <p><a href="contacto.html">Contacto</a></p>
        <p><a href="login.html">Ingresar</a></p>
      </div>
    </div>
    <div style="max-width:1200px;margin:1.75rem auto 0;padding:0 1rem;color:rgba(255,255,255,0.45);font-size:0.95rem;">
      © 2026 COHAB BJJ — Santiago, Chile
    </div>
  </footer>

  <div class="marketing-cta-bar" aria-label="Acciones rápidas">
    <a class="btn btn-primary" href="contacto.html">Empieza a entrenar</a>
    <a class="btn btn-secondary" href="#horariosHome">Ver horarios</a>
  </div>

  <!-- WhatsApp Flotante -->
  <a href="https://wa.me/56912345678?text=Hola!%20Quiero%20información%20sobre%20clases%20de%20BJJ"
     class="whatsapp-float"
     target="_blank"
     rel="noopener noreferrer"
     aria-label="Contactar por WhatsApp">
    <svg viewBox="0 0 32 32" width="28" height="28" fill="currentColor">
      <path d="M16 0C7.163 0 0 7.163 0 16c0 2.825.736 5.48 2.024 7.792L.672 30.328l6.688-1.76C9.632 30.264 12.696 32 16 32c8.837 0 16-7.163 16-16S24.837 0 16 0zm0 29.36c-2.608 0-5.04-.752-7.096-2.04l-.512-.304-5.016 1.32 1.344-4.904-.336-.536C2.768 21.056 2 18.592 2 16 2 8.268 8.268 2 16 2s14 6.268 14 14-6.268 13.36-14 13.36zm7.68-10.016c-.416-.208-2.472-1.224-2.856-1.36-.384-.144-.664-.208-.944.208-.28.416-1.088 1.36-1.328 1.64-.24.28-.488.32-.904.104-.416-.208-1.76-.648-3.352-2.072-1.24-1.104-2.08-2.472-2.32-2.888-.24-.416-.024-.64.184-.848.184-.184.416-.488.624-.728.208-.24.28-.416.416-.696.144-.28.072-.52-.032-.728-.104-.208-.944-2.272-1.296-3.112-.336-.808-.68-.696-.944-.712-.24-.008-.52-.016-.8-.016s-.736.104-1.12.52c-.384.416-1.472 1.44-1.472 3.512s1.504 4.072 1.712 4.352c.208.28 2.944 4.496 7.136 6.304.992.432 1.768.688 2.376.88.992.32 1.896.272 2.608.168.8-.12 2.472-.992 2.816-1.96.344-.968.344-1.792.24-1.96-.096-.176-.368-.28-.784-.488z"/>
    </svg>
    <span>WhatsApp</span>
  </a>

  <!-- Script para consulta de alumnos -->
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <script>
    let qrStreamIndex = null;
    let qrScanningIndex = false;
    let qrAnimationFrameIndex = null;
    
    async function toggleQRScannerIndex() {
      const container = document.getElementById('qrScannerContainerIndex');
      const video = document.getElementById('qrVideoIndex');
      const overlay = document.getElementById('qrScanningOverlayIndex');
      const btn = document.getElementById('scanQRBtnIndex');
      const btnText = document.getElementById('scanQRTextIndex');
      
      if (qrScanningIndex) {
        stopQRScannerIndex();
        return;
      }
      
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert('Tu navegador no soporta acceso a la cámara. Por favor, ingresa tu ID manualmente.');
        return;
      }
      
      try {
        qrStreamIndex = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: 'environment' }
        });
        
        video.srcObject = qrStreamIndex;
        video.setAttribute('playsinline', 'true');
        await video.play();
        
        container.style.display = 'block';
        overlay.style.display = 'block';
        qrScanningIndex = true;
        btnText.textContent = 'Escaneando...';
        
        const canvas = document.getElementById('qrCanvasIndex');
        const context = canvas.getContext('2d');
        
        function scanQR() {
          if (!qrScanningIndex) return;
          
          if (video.readyState === video.HAVE_ENOUGH_DATA) {
            canvas.height = video.videoHeight;
            canvas.width = video.videoWidth;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);
            
            if (code) {
              const url = new URL(code.data);
              const id = url.searchParams.get('id');
              if (id) {
                stopQRScannerIndex();
                window.location.href = `public/alumno.html?id=${id}`;
                return;
              }
            }
          }
          
          qrAnimationFrameIndex = requestAnimationFrame(scanQR);
        }
        
        scanQR();
      } catch (error) {
        console.error('Error accediendo a la cámara:', error);
        alert('No se pudo acceder a la cámara. Por favor, ingresa tu ID manualmente.');
        stopQRScannerIndex();
      }
    }
    
    function stopQRScannerIndex() {
      qrScanningIndex = false;
      if (qrAnimationFrameIndex) {
        cancelAnimationFrame(qrAnimationFrameIndex);
        qrAnimationFrameIndex = null;
      }
      if (qrStreamIndex) {
        qrStreamIndex.getTracks().forEach(track => track.stop());
        qrStreamIndex = null;
      }
      
      const video = document.getElementById('qrVideoIndex');
      const container = document.getElementById('qrScannerContainerIndex');
      const overlay = document.getElementById('qrScanningOverlayIndex');
      const btnText = document.getElementById('scanQRTextIndex');
      
      if (video) {
        video.srcObject = null;
        video.pause();
      }
      if (overlay) overlay.style.display = 'none';
      if (container) container.style.display = 'none';
      if (btnText) btnText.textContent = 'Escanear QR';
    }
    
    function consultarAlumnoIndex() {
      const input = document.getElementById('alumnoIdInputIndex');
      const id = input.value.trim();
      
      if (!id) {
        alert('Por favor ingresa tu ID de alumno');
        return;
      }
      
      window.location.href = `public/alumno.html?id=${id}`;
    }
    
    // Limpiar al salir de la página
    window.addEventListener('beforeunload', stopQRScannerIndex);
  </script>

  <!-- Script para consulta de alumnos -->
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <script>
    let qrStreamIndex = null;
    let qrScanningIndex = false;
    let qrAnimationFrameIndex = null;
    
    async function toggleQRScannerIndex() {
      const container = document.getElementById('qrScannerContainerIndex');
      const video = document.getElementById('qrVideoIndex');
      const overlay = document.getElementById('qrScanningOverlayIndex');
      const btn = document.getElementById('scanQRBtnIndex');
      const btnText = document.getElementById('scanQRTextIndex');
      
      if (qrScanningIndex) {
        stopQRScannerIndex();
        return;
      }
      
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert('Tu navegador no soporta acceso a la cámara. Por favor, ingresa tu ID manualmente.');
        return;
      }
      
      try {
        qrStreamIndex = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: 'environment' }
        });
        
        video.srcObject = qrStreamIndex;
        video.setAttribute('playsinline', 'true');
        await video.play();
        
        container.style.display = 'block';
        overlay.style.display = 'block';
        qrScanningIndex = true;
        btnText.textContent = 'Escaneando...';
        
        const canvas = document.getElementById('qrCanvasIndex');
        const context = canvas.getContext('2d');
        
        function scanQR() {
          if (!qrScanningIndex) return;
          
          if (video.readyState === video.HAVE_ENOUGH_DATA) {
            canvas.height = video.videoHeight;
            canvas.width = video.videoWidth;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);
            
            if (code) {
              const url = new URL(code.data);
              const id = url.searchParams.get('id');
              if (id) {
                stopQRScannerIndex();
                window.location.href = `public/alumno.html?id=${id}`;
                return;
              }
            }
          }
          
          qrAnimationFrameIndex = requestAnimationFrame(scanQR);
        }
        
        scanQR();
      } catch (error) {
        console.error('Error accediendo a la cámara:', error);
        alert('No se pudo acceder a la cámara. Por favor, ingresa tu ID manualmente.');
        stopQRScannerIndex();
      }
    }
    
    function stopQRScannerIndex() {
      qrScanningIndex = false;
      if (qrAnimationFrameIndex) {
        cancelAnimationFrame(qrAnimationFrameIndex);
        qrAnimationFrameIndex = null;
      }
      if (qrStreamIndex) {
        qrStreamIndex.getTracks().forEach(track => track.stop());
        qrStreamIndex = null;
      }
      
      const video = document.getElementById('qrVideoIndex');
      const container = document.getElementById('qrScannerContainerIndex');
      const overlay = document.getElementById('qrScanningOverlayIndex');
      const btnText = document.getElementById('scanQRTextIndex');
      
      if (video) {
        video.srcObject = null;
        video.pause();
      }
      if (overlay) overlay.style.display = 'none';
      if (container) container.style.display = 'none';
      if (btnText) btnText.textContent = 'Escanear QR';
    }
    
    function consultarAlumnoIndex() {
      const input = document.getElementById('alumnoIdInputIndex');
      const id = input.value.trim();
      
      if (!id) {
        alert('Por favor ingresa tu ID de alumno');
        return;
      }
      
      window.location.href = `public/alumno.html?id=${id}`;
    }
    
    // Limpiar al salir de la página
    window.addEventListener('beforeunload', stopQRScannerIndex);
  </script>

  <script>
    (function () {
      const menuBtn = document.getElementById('menuBtn');
      const drawer = document.getElementById('drawer');
      const backdrop = document.getElementById('drawerBackdrop');
      const closeBtn = document.getElementById('drawerClose');

      function openDrawer() {
        if (!drawer || !backdrop) return;
        drawer.style.display = 'block';
        backdrop.style.display = 'block';
        drawer.setAttribute('aria-hidden', 'false');
        backdrop.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
      }

      function closeDrawer() {
        if (!drawer || !backdrop) return;
        drawer.style.display = 'none';
        backdrop.style.display = 'none';
        drawer.setAttribute('aria-hidden', 'true');
        backdrop.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
      }

      // Abrir drawer - soporte para click y touch
      if (menuBtn) {
        menuBtn.addEventListener('click', function(e) {
          e.preventDefault();
          openDrawer();
        });
        menuBtn.addEventListener('touchend', function(e) {
          e.preventDefault();
          openDrawer();
        });
      }
      
      // Cerrar drawer - soporte para click y touch
      if (closeBtn) {
        closeBtn.addEventListener('click', function(e) {
          e.preventDefault();
          closeDrawer();
        });
        closeBtn.addEventListener('touchend', function(e) {
          e.preventDefault();
          closeDrawer();
        });
      }
      
      // Cerrar drawer solo cuando se hace clic/touch en el backdrop
      if (backdrop) {
        backdrop.addEventListener('click', function(e) {
          if (e.target === backdrop) {
            closeDrawer();
          }
        });
        backdrop.addEventListener('touchend', function(e) {
          if (e.target === backdrop) {
            e.preventDefault();
            closeDrawer();
          }
        });
      }
      
      // Enlaces del drawer: NO agregar listeners - dejar que funcionen 100% nativamente
      // El drawer se cerrará automáticamente cuando la página navegue
      // Solo cerramos manualmente cuando se hace clic en el backdrop
      
      window.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') closeDrawer();
      });
    })();
  </script>
  
  <!-- Service Worker Registration con actualización forzada -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js', { updateViaCache: 'none' })
          .then(function(registration) {
            console.log('[SW] Registrado:', registration.scope);
            
            // Si hay una nueva versión del SW, forzar actualización inmediata
            registration.addEventListener('updatefound', function() {
              const newWorker = registration.installing;
              if (newWorker) {
                newWorker.addEventListener('statechange', function() {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // Nueva versión instalada - recargar para usar la nueva
                    console.log('[SW] Nueva versión disponible, recargando...');
                    window.location.reload();
                  }
                });
              }
            });
            
            // Verificar actualizaciones periódicamente
            setInterval(function() {
              registration.update();
            }, 60000); // Cada minuto
          })
          .catch(function(error) {
            console.warn('[SW] Error al registrar:', error);
          });
      });
    }
  </script>
</body>
</html>

